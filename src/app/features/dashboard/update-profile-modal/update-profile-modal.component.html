<div class="modal-overlay" (click)="handleClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Update Profile</h2>
      <button type="button" class="close-button" (click)="handleClose()" aria-label="Close modal">
        <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </svg>
      </button>
    </div>

    @if (serverMessage(); as message) {
      <div class="alert" [class.success]="message.type === 'success'" [class.error]="message.type === 'error'">
        {{ message.text }}
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="handleSubmit()" novalidate>
      <label class="field">
        <span class="field-label">Date of Birth</span>
        <input
          type="date"
          formControlName="dateOfBirth"
          placeholder="YYYY-MM-DD"
        />
      </label>

      <label class="field">
        <span class="field-label">National Identity Number</span>
        <input
          type="text"
          formControlName="nationalIdentityNumber"
          placeholder="Enter your national ID number"
        />
      </label>

      <label class="field">
        <span class="field-label">Gender</span>
        <select formControlName="gender">
          <option value="">Select gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </label>

      <label class="field">
        <span class="field-label">Profile Picture</span>
        <div class="file-upload-area">
          @if (previewUrl(); as preview) {
            <div class="image-preview">
              <img [src]="preview" alt="Profile preview" />
              <button type="button" class="remove-image" (click)="removeFile()" aria-label="Remove image">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
              </button>
            </div>
          } @else {
            <div class="file-upload-placeholder">
              <input
                type="file"
                id="profilePicture"
                accept="image/jpeg,image/png,image/gif,image/webp"
                (change)="handleFileSelect($event)"
                style="display: none;"
              />
              <label for="profilePicture" class="file-upload-label">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
                  <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <span>Click to upload or drag and drop</span>
                <small>JPEG, PNG, GIF, WebP (Max 5MB)</small>
              </label>
            </div>
          }
        </div>
      </label>

      <div class="modal-actions">
        <button type="button" class="ghost" (click)="handleClose()" [disabled]="loading()">
          Cancel
        </button>
        <button type="submit" class="primary" [disabled]="loading()">
          @if (loading()) {
            <span class="loader"></span>
            Updating...
          } @else {
            Update Profile
          }
        </button>
      </div>
    </form>
  </div>
</div>
