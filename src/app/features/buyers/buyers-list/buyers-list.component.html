<section class="buyers-list">
  <header class="page-header">
    <div>
      <p class="eyebrow">Buyers</p>
      <h1>All Buyers</h1>
      <p class="description">
        View all buyers and the number of stands associated with each buyer.
      </p>
    </div>
    <div class="header-actions">
      <button type="button" class="add-buyer-button" (click)="openAddBuyerModal()">
        <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
        </svg>
        Add Buyer
      </button>
      <button type="button" class="refresh-button" (click)="refresh()" [disabled]="loading()">
        <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
        </svg>
        Refresh
      </button>
    </div>
  </header>

  <div class="buyers-table-container" *ngIf="!error(); else errorState">
    <div *ngIf="loading(); else buyersTable" class="loading-state">
      <p>Loading buyers...</p>
    </div>
  </div>

  <ng-template #buyersTable>
    <div class="buyers-table-wrapper">
      <table class="buyers-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>National ID</th>
            <th>Stands</th>
            <th>Date Added</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let buyer of buyers(); trackBy: trackByBuyerId">
            <td>
              <strong>{{ buyer.firstName }} {{ buyer.lastName }}</strong>
            </td>
            <td>{{ buyer.email }}</td>
            <td>{{ buyer.phoneNumber }}</td>
            <td>{{ buyer.nationalIdentityNumber || '—' }}</td>
            <td>
              <span class="stand-count-badge">{{ buyer.standCount }}</span>
            </td>
            <td>{{ formatDate(buyer.createdAt) }}</td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="buyers().length === 0" class="empty-state">
        <p>No buyers found.</p>
        <p class="empty-state-helper">Buyers will appear here once they are added to stands.</p>
      </div>
    </div>
  </ng-template>

  <ng-template #errorState>
    <div class="error-state">
      <p>{{ error() }}</p>
      <button type="button" class="primary-button" (click)="refresh()">Try Again</button>
    </div>
  </ng-template>
</section>

<!-- Add Buyer Modal -->
<div *ngIf="showAddBuyerModal()" class="modal-overlay" (click)="closeAddBuyerModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Add Buyer</h2>
      <button type="button" class="close-button" (click)="closeAddBuyerModal()" aria-label="Close modal">
        <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </svg>
      </button>
    </div>

    <form (ngSubmit)="handleAddBuyerSubmit($event)" class="add-buyer-form">
      <p class="modal-description">
        Add a new buyer to the platform. This buyer will not be associated with any stand.
      </p>

      <div class="form-grid">
        <label>
          <span>First name *</span>
          <input
            type="text"
            [(ngModel)]="addBuyerForm.firstName"
            name="buyerFirstName"
            required
            placeholder="Enter first name"
          />
        </label>
        <label>
          <span>Last name *</span>
          <input
            type="text"
            [(ngModel)]="addBuyerForm.lastName"
            name="buyerLastName"
            required
            placeholder="Enter last name"
          />
        </label>
        <label>
          <span>Email *</span>
          <input
            type="email"
            [(ngModel)]="addBuyerForm.email"
            name="buyerEmail"
            required
            placeholder="Enter email address"
          />
        </label>
        <label>
          <span>Phone number *</span>
          <input
            type="tel"
            [(ngModel)]="addBuyerForm.phoneNumber"
            name="buyerPhone"
            required
            placeholder="Enter phone number"
          />
        </label>
        <label>
          <span>Password *</span>
          <input
            type="password"
            [(ngModel)]="addBuyerForm.password"
            name="buyerPassword"
            required
            placeholder="Set a password for the buyer"
          />
        </label>
        <label class="full-width">
          <span>National ID</span>
          <input
            type="text"
            [(ngModel)]="addBuyerForm.nationalIdentityNumber"
            name="buyerNationalId"
            placeholder="70-1234567H12"
          />
        </label>
      </div>

      <p class="form-feedback error" *ngIf="addBuyerError()">{{ addBuyerError() }}</p>
      <p class="form-feedback success" *ngIf="addBuyerSuccess()">{{ addBuyerSuccess() }}</p>

      <div class="form-actions">
        <button type="button" class="ghost-button" (click)="closeAddBuyerModal()">Cancel</button>
        <button type="submit" class="primary-button" [disabled]="addBuyerSubmitting()">
          {{ addBuyerSubmitting() ? 'Adding Buyer…' : 'Add Buyer' }}
        </button>
      </div>
    </form>
  </div>
</div>
