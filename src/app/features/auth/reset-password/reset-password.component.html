<section class="auth-page">
  <div class="auth-card">
    <div class="card-header">
      <p class="eyebrow">Reset access</p>
      <h1>Reset your password</h1>
      <p class="helper">Use the verification code sent to your inbox and pick a new password.</p>
    </div>

    @if (serverMessage(); as message) {
      <div class="alert" [class.success]="message.type === 'success'" [class.error]="message.type === 'error'">
        {{ message.text }}
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="handleSubmit()" novalidate>
      <label class="field has-icon icon-mail">
        <span class="field-label">Account email</span>
        <input
          type="email"
          placeholder="name@company.com"
          formControlName="email"
          [class.invalid]="form.controls.email.invalid && (form.controls.email.touched || submitted())"
          autocomplete="email"
        />
        @if (form.controls.email.invalid && (form.controls.email.touched || submitted())) {
          <small>Enter the email you used to request the reset code.</small>
        }
      </label>

      <label class="field">
        <span class="field-label">Verification code</span>
        <input
          type="text"
          placeholder="6-digit code"
          formControlName="code"
          [class.invalid]="form.controls.code.invalid && (form.controls.code.touched || submitted())"
          inputmode="numeric"
          autocomplete="one-time-code"
        />
        @if (form.controls.code.invalid && (form.controls.code.touched || submitted())) {
          <small>Enter the verification code from your email.</small>
        }
      </label>

      <label class="field password-field">
        <span class="field-label">New password</span>
        <div class="password-input">
          <input
            [type]="passwordVisible() ? 'text' : 'password'"
            placeholder="New password"
            formControlName="password"
            [class.invalid]="form.controls.password.invalid && (form.controls.password.touched || submitted())"
            autocomplete="new-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePassword('password')"
            [attr.aria-label]="passwordVisible() ? 'Hide password' : 'Show password'"
          >
            @if (passwordVisible()) {
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 1l22 22" stroke="#ef4444"></path>
                <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a19.16 19.16 0 013.17-4.73"></path>
                <path d="M10.58 10.58A3 3 0 0113.42 13.42"></path>
              </svg>
            } @else {
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#4b5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            }
          </button>
        </div>
        @if (form.controls.password.invalid && (form.controls.password.touched || submitted())) {
          <small>Use at least 6 characters.</small>
        }
      </label>

      <label class="field password-field">
        <span class="field-label">Confirm new password</span>
        <div class="password-input">
          <input
            [type]="confirmVisible() ? 'text' : 'password'"
            placeholder="Repeat password"
            formControlName="confirmPassword"
            [class.invalid]="
              (form.controls.confirmPassword.touched || submitted()) &&
              (!!form.controls.confirmPassword.errors || form.hasError('passwordMismatch'))
            "
            autocomplete="new-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePassword('confirmPassword')"
            [attr.aria-label]="confirmVisible() ? 'Hide password' : 'Show password'"
          >
            @if (confirmVisible()) {
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 1l22 22" stroke="#ef4444"></path>
                <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a19.16 19.16 0 013.17-4.73"></path>
                <path d="M10.58 10.58A3 3 0 0113.42 13.42"></path>
              </svg>
            } @else {
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#4b5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            }
          </button>
        </div>
        @if (form.controls.confirmPassword.invalid && (form.controls.confirmPassword.touched || submitted())) {
          <small>Confirm your new password.</small>
        } @else if (form.hasError('passwordMismatch') && (form.controls.confirmPassword.touched || submitted())) {
          <small>Passwords must match.</small>
        }
      </label>

      <button type="submit" class="primary" [disabled]="loading()">
        @if (loading()) {
          <span class="loader"></span>
          Updating...
        } @else {
          Reset password
        }
      </button>
    </form>

    <p class="footer-link">
      Need a new code?
      <a routerLink="../forgot-password">Request another reset email</a>
    </p>
    <p class="footer-link">
      Ready to log in?
      <a routerLink="../login">Back to sign in</a>
    </p>
  </div>
</section>

